<!-- Product Card Component - Reusable product card -->
<div class="col-lg-3 col-md-4 col-sm-6 mb-4">
    <div class="card product-card product-card-component h-100" data-product-id="{{productId}}">
        <!-- Product Image -->
        <div class="product-image product-card-image">
            <img src="{{productImage}}" alt="{{productName}}" class="card-img-top">
            
            <!-- Product Badge (if on sale, new, etc.) -->
            {{#if badge}}
            <span class="badge product-card-badge">{{badge}}</span>
            {{/if}}
            
            <!-- Hover Overlay -->
            <div class="product-overlay product-card-overlay">
                <div class="product-actions product-card-actions">
                    <button class="btn btn-sm btn-light product-card-action" onclick="quickView('{{productId}}')" title="Quick View">
                        <i class="fas fa-eye"></i>
                        <span>Quick View</span>
                    </button>
                    <button class="btn btn-sm btn-primary product-card-action" onclick="addToCart('{{productId}}')" title="Add to Cart">
                        <i class="fas fa-shopping-cart"></i>
                        <span>Add to Cart</span>
                    </button>
                    <button class="btn btn-sm btn-outline-light product-card-action" onclick="toggleWishlist('{{productId}}')" title="Add to Wishlist">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Product Info -->
        <div class="card-body product-info product-card-info">
            <h5 class="card-title product-title product-card-title">{{productName}}</h5>
            
            <!-- Product Price -->
            <div class="product-price product-card-price">
                ${{price}}
                {{#if originalPrice}}
                <span class="product-price-old product-card-price-old">${{originalPrice}}</span>
                {{/if}}
            </div>
            
            <!-- Product Rating -->
            {{#if rating}}
            <div class="product-rating product-card-rating">
                <div class="rating-stars product-card-stars">
                    {{#each stars}}
                    <i class="fas fa-star{{#unless this}} text-muted{{/unless}}"></i>
                    {{/each}}
                </div>
                <span class="rating-count">({{reviewCount}} reviews)</span>
            </div>
            {{/if}}
            
            <!-- Available Colors -->
            {{#if colors}}
            <div class="product-colors mt-2">
                <small class="text-muted">Available in {{colors.length}} colors</small>
                <div class="color-options d-flex gap-1 mt-1">
                    {{#each colors}}
                    <span class="color-dot" style="background-color: {{this.hex}}" title="{{this.name}}"></span>
                    {{/each}}
                </div>
            </div>
            {{/if}}
            
            <!-- Stock Status -->
            {{#if stockStatus}}
            <div class="stock-status mt-2">
                <span class="badge {{#if inStock}}badge-success{{else}}badge-danger{{/if}}">
                    {{#if inStock}}In Stock{{else}}Out of Stock{{/if}}
                </span>
            </div>
            {{/if}}
        </div>
    </div>
</div>

<style>
/* Product Card Component Styles */
.product-card-component {
    transition: all 0.3s ease;
    border: none;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.product-card-component:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.product-card-image {
    position: relative;
    overflow: hidden;
    height: 250px;
    background: #f8f9fa;
}

.product-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.product-card-component:hover .product-card-image img {
    transform: scale(1.05);
}

.product-card-badge {
    position: absolute;
    top: 1rem;
    left: 1rem;
    z-index: 2;
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
}

.product-card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.product-card-component:hover .product-card-overlay {
    opacity: 1;
}

.product-card-actions {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    justify-content: center;
}

.product-card-action {
    border-radius: 50px;
    padding: 0.5rem 1rem;
    font-weight: 600;
    font-size: 0.875rem;
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s ease;
}

.product-card-component:hover .product-card-action {
    transform: translateY(0);
    opacity: 1;
}

.product-card-component:hover .product-card-action:nth-child(1) {
    transition-delay: 0.1s;
}

.product-card-component:hover .product-card-action:nth-child(2) {
    transition-delay: 0.2s;
}

.product-card-component:hover .product-card-action:nth-child(3) {
    transition-delay: 0.3s;
}

.product-card-info {
    padding: 1.5rem;
}

.product-card-title {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    line-height: 1.3;
    color: var(--text-dark);
}

.product-card-price {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--accent-color);
    margin-bottom: 0.5rem;
}

.product-card-price-old {
    font-size: 1rem;
    color: var(--text-light);
    text-decoration: line-through;
    margin-left: 0.5rem;
    font-weight: normal;
}

.product-card-rating {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 0.5rem;
}

.product-card-stars {
    color: #ffc107;
}

.color-options {
    margin-top: 0.5rem;
}

.color-dot {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: transform 0.2s ease;
}

.color-dot:hover {
    transform: scale(1.1);
}

.stock-status {
    margin-top: 0.5rem;
}

.badge-success {
    background-color: #198754;
}

.badge-danger {
    background-color: #dc3545;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .product-card-actions {
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .product-card-action {
        font-size: 0.8rem;
        padding: 0.4rem 0.8rem;
    }
    
    .product-card-info {
        padding: 1rem;
    }
    
    .product-card-title {
        font-size: 1rem;
    }
    
    .product-card-price {
        font-size: 1.1rem;
    }
}

@media (max-width: 576px) {
    .product-card-image {
        height: 200px;
    }
    
    .product-card-actions {
        flex-direction: row;
        justify-content: space-around;
    }
    
    .product-card-action span {
        display: none;
    }
    
    .product-card-action {
        width: auto;
        padding: 0.5rem;
        border-radius: 50%;
    }
}
</style>

<script>
// Product Card Component JavaScript
(function() {
    'use strict';
    
    // Product card functionality
    window.productCardComponent = {
        // Quick view product
        quickView: function(productId) {
            console.log('Quick view product:', productId);
            
            if (window.productManager) {
                window.productManager.showQuickView(productId);
            } else {
                // Fallback - redirect to product detail page
                window.location.href = `/frontend/pages/product-detail.html?id=${productId}`;
            }
        },
        
        // Add product to cart
        addToCart: function(productId) {
            console.log('Add to cart:', productId);
            
            if (window.productManager) {
                window.productManager.quickAddToCart(productId).then(result => {
                    if (result.success) {
                        if (window.app) {
                            window.app.showToast('Product added to cart!', 'success');
                        }
                        // Update cart count
                        if (window.headerComponent) {
                            window.headerComponent.updateCartCount();
                        }
                    } else {
                        if (window.app) {
                            window.app.showToast(result.error || 'Failed to add to cart', 'error');
                        }
                    }
                });
            } else {
                // Fallback - show message
                if (window.app) {
                    window.app.showToast('Please select size and color first', 'info');
                }
                window.location.href = `/frontend/pages/product-detail.html?id=${productId}`;
            }
        },
        
        // Toggle wishlist
        toggleWishlist: function(productId) {
            console.log('Toggle wishlist:', productId);
            
            if (window.authManager && !window.authManager.isAuthenticated()) {
                if (window.app) {
                    window.app.showToast('Please login to add to wishlist', 'info');
                }
                return;
            }
            
            if (window.productManager) {
                window.productManager.toggleWishlist(productId).then(result => {
                    if (result.success) {
                        const message = result.added ? 'Added to wishlist!' : 'Removed from wishlist!';
                        if (window.app) {
                            window.app.showToast(message, 'success');
                        }
                        
                        // Update wishlist icon
                        const card = document.querySelector(`[data-product-id="${productId}"]`);
                        const heartIcon = card.querySelector('.fa-heart');
                        if (heartIcon) {
                            heartIcon.classList.toggle('fas', result.added);
                            heartIcon.classList.toggle('far', !result.added);
                        }
                    }
                });
            }
        },
        
        // Render product card from data
        render: function(product, container) {
            const template = this.getTemplate();
            const html = this.processTemplate(template, product);
            
            if (container) {
                container.insertAdjacentHTML('beforeend', html);
            }
            
            return html;
        },
        
        // Get product card template
        getTemplate: function() {
            return document.querySelector('.product-card-component').outerHTML;
        },
        
        // Process template with product data
        processTemplate: function(template, product) {
            let html = template;
            
            // Replace template variables
            html = html.replace(/\{\{productId\}\}/g, product.product_id || product.id);
            html = html.replace(/\{\{productImage\}\}/g, product.product_image || product.image || '/assets/images/placeholder.jpg');
            html = html.replace(/\{\{productName\}\}/g, product.product_name || product.name);
            html = html.replace(/\{\{price\}\}/g, this.formatPrice(product.price));
            
            // Handle optional fields
            if (product.original_price && product.original_price > product.price) {
                html = html.replace(/\{\{originalPrice\}\}/g, this.formatPrice(product.original_price));
            } else {
                html = html.replace(/\{\{#if originalPrice\}\}[\s\S]*?\{\{\/if\}\}/g, '');
            }
            
            // Handle badge
            if (product.badge) {
                html = html.replace(/\{\{badge\}\}/g, product.badge);
            } else {
                html = html.replace(/\{\{#if badge\}\}[\s\S]*?\{\{\/if\}\}/g, '');
            }
            
            // Handle rating
            if (product.rating) {
                const stars = this.generateStars(product.rating);
                html = html.replace(/\{\{#each stars\}\}[\s\S]*?\{\{\/each\}\}/g, stars);
                html = html.replace(/\{\{reviewCount\}\}/g, product.review_count || 0);
            } else {
                html = html.replace(/\{\{#if rating\}\}[\s\S]*?\{\{\/if\}\}/g, '');
            }
            
            // Handle colors
            if (product.colors && product.colors.length > 0) {
                const colorDots = product.colors.map(color => 
                    `<span class="color-dot" style="background-color: ${color.hex}" title="${color.name}"></span>`
                ).join('');
                html = html.replace(/\{\{#each colors\}\}[\s\S]*?\{\{\/each\}\}/g, colorDots);
            } else {
                html = html.replace(/\{\{#if colors\}\}[\s\S]*?\{\{\/if\}\}/g, '');
            }
            
            // Handle stock status
            if (product.stock_quantity !== undefined) {
                const inStock = product.stock_quantity > 0;
                html = html.replace(/\{\{#if inStock\}\}/g, inStock ? '' : '<!--');
                html = html.replace(/\{\{else\}\}/g, inStock ? '-->' : '');
                html = html.replace(/\{\{\/if\}\}/g, inStock ? '' : '-->');
            } else {
                html = html.replace(/\{\{#if stockStatus\}\}[\s\S]*?\{\{\/if\}\}/g, '');
            }
            
            return html;
        },
        
        // Format price
        formatPrice: function(price) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(price);
        },
        
        // Generate star rating HTML
        generateStars: function(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let stars = '';
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            
            // Half star
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            
            // Empty stars
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            
            return stars;
        }
    };
    
    // Make functions globally available
    window.quickView = window.productCardComponent.quickView;
    window.addToCart = window.productCardComponent.addToCart;
    window.toggleWishlist = window.productCardComponent.toggleWishlist;
    
})();
</script>
